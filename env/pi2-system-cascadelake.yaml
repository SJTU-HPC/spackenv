---
spack_config:           /lustre/home/rpm/.spack
spack_bin_root:         /lustre/spack
spack_install_root:     /lustre

modules:
  tcl:
    hash_length: 0
    naming_scheme: '{name}/{version}-{compiler.name}-{compiler.version}'
    blacklist:
      - 'autoconf'
      - 'automake'
      - 'bzip2'
      - 'bison'
      - 'cgal'
      - 'diffutils'
      - 'flex'
      - 'expat'
      - 'gettext'
      - 'glib'
      - 'gdbm'
      - 'gmp'
      - 'gnutls'
      - 'hwloc'
      - 'help2man'
      - 'isl'
      - 'json-c'
      - 'kahip'
      - 'libarchive'
      - 'libidn2'
      - 'libsigsegv'
      - 'libtool'
      - 'libfabric'
      - 'libffi'
      - 'libgcrypt'
      - 'libgpg-error'
      - 'libbsd'
      - 'libiconv'
      - 'libpciaccess'
      - 'libuv'
      - 'libunistring'
      - 'libxml2'
      - 'lz4'
      - 'lzo'
      - 'm4'
      - 'mpc'
      - 'mpfr'
      - 'nettle'
      - 'ncurses'
      - 'numactl'
      - 'openssl'
      - 'pcre'
      - 'pkgconf'
      - 'perl%gcc@4.8.5'
      - 'py-setuptools'
      - 'readline'
      - 'rhash'
      - 'sqlite'
      - 'slurm'
      - 'scotch'
      - 'tar'
      - 'util-macros'
      - 'xz'
      - 'zlib'
    all:
      conflict:
        - '{name}' 

packages:
  all:
    compiler: [gcc, intel, pgi]
    providers:
      mpi: [openmpi, mvapich2, mpich, intel-mpi]
      blas: [openblas, intel-mkl]
      lapack: [openblas, intel-mkl]
      scalapack: [netlib-scalapack, intel-mkl]
    variants: ~mpi +openmp
  python:
    variants: +ucs4
  intel-mkl:
    variants: threads=openmp
  slurm:
    paths:
      slurm@17-11-9-13: /usr
    buildable: False
  libfabric:
    paths:
      libfabric@1.6.2: /usr

msg: |
  Please add the following to your ~/.bashrc:
    
  export SPACK_ROOT=/lustre/spack
  source $SPACK_ROOT/share/spack/setup-env.sh 

compilers:
  - compiler:
      environment: {}
      extra_rpaths: []
      flags: {}
      modules: []
      operating_system: centos7
      paths:
        cc: /usr/bin/gcc
        cxx: /usr/bin/g++
        f77: /usr/bin/gfortran
        fc: /usr/bin/gfortran
      spec: gcc@4.8.5
      target: x86_64
  - compiler:
      environment: {}
      extra_rpaths: []
      flags: {}
      modules: []
      operating_system: centos7
      paths:
        cc:  /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-5.4.0-mufy3fjs33jgj47lb3346bqktgtjnt4i/bin/gcc
        cxx: /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-5.4.0-mufy3fjs33jgj47lb3346bqktgtjnt4i/bin/g++
        f77: /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-5.4.0-mufy3fjs33jgj47lb3346bqktgtjnt4i/bin/gfortran
        fc:  /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-5.4.0-mufy3fjs33jgj47lb3346bqktgtjnt4i/bin/gfortran
      spec: gcc@5.4.0
      target: x86_64
  - compiler:
      environment: {}
      extra_rpaths: []
      flags: {}
      modules: []
      operating_system: centos7
      paths:
        cc:  /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-8.3.0-wwpinbruamhvwaqdjijnfou7xkmb5knx/bin/gcc
        cxx: /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-8.3.0-wwpinbruamhvwaqdjijnfou7xkmb5knx/bin/g++
        f77: /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-8.3.0-wwpinbruamhvwaqdjijnfou7xkmb5knx/bin/gfortran
        fc:  /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/gcc-8.3.0-wwpinbruamhvwaqdjijnfou7xkmb5knx/bin/gfortran
      spec: gcc@8.3.0
      target: x86_64
  - compiler:
      environment: {}
      extra_rpaths: []
      flags: {}
      modules: []
      operating_system: centos7
      paths:
        cc:  /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/intel-19.0.3-4vf3wugrvromolotwrco5vuzydnts3bv/compilers_and_libraries_2019.3.199/linux/bin/intel64/icc
        cxx: /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/intel-19.0.3-4vf3wugrvromolotwrco5vuzydnts3bv/compilers_and_libraries_2019.3.199/linux/bin/intel64/icpc
        f77: /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/intel-19.0.3-4vf3wugrvromolotwrco5vuzydnts3bv/compilers_and_libraries_2019.3.199/linux/bin/intel64/ifort
        fc:  /lustre/opt/cascadelake/linux-centos7-x86_64/gcc-4.8.5/intel-19.0.3-4vf3wugrvromolotwrco5vuzydnts3bv/compilers_and_libraries_2019.3.199/linux/bin/intel64/ifort
      spec: intel@19.0.3
      target: x86_64

mirrors:
  remote_server: http://spack.pi.sjtu.edu.cn/mirror

install:
  - 'intel-parallel-studio@cluster.2019.3+advisor+clck+daal+inspector+ipp+itac+mkl+mpi+tbb+vtune %gcc@4.8.5 threads=openmp'
  - 'intel-mpi@2019.3.199 %intel@19.0.3'
  - 'intel-mpi@2019.3.199 %gcc@8.3.0'
  - 'intel-mkl@2019.3.199 %intel@19.0.3'
  - 'intel-mkl@2019.3.199 %gcc@8.3.0'
  - 'intel-mkl-dnn %intel@19.0.3 ^gnutls%gcc@8.3.0'
  - 'miniconda2@4.6.14 %gcc@8.3.0'
  - 'miniconda3@4.6.14 %gcc@8.3.0'
  - 'miniconda2@4.6.14 %intel@19.0.3'
  - 'miniconda3@4.6.14 %intel@19.0.3'
  - 'cuda@9.0.176 %gcc@5.4.0'
  - 'cuda@9.0.176 %intel@19.0.3'
  - 'cuda@10.0.130 %gcc@5.4.0'
  - 'cuda@10.0.130 %intel@19.0.3'
  - 'jdk@11.0.2_9 %gcc@8.3.0'
  - 'jdk@11.0.2_9 %intel@19.0.3'
  - 'emacs+tls %gcc@4.8.5'
  - 'openblas+avx2+avx512 %gcc@8.3.0 threads=openmp'
  - 'openblas+avx2+avx512 %intel@19.0.3 threads=openmp'
  - 'bowtie2 %gcc@8.3.0'
  - 'bowtie2 %intel@19.0.3 ^gnutls%gcc@8.3.0'
  - 'bwa %gcc@8.3.0'
  - 'bwa %intel@19.0.3'
  - 'samtools %gcc@8.3.0'
  - 'samtools %intel@19.0.3'
  - 'stream+openmp %intel@19.0.3 cflags="-O3 -xHost -ffreestanding -fopenmp"'
  - 'stream+openmp %gcc@8.3.0 cflags="-O3 -fopenmp"'
  - 'openmpi@4.0.1+pmi fabrics=libfabric schedulers=slurm %gcc@8.3.0' # Use libfabric@1.6.2 shipped with OS to build against GCC
  - 'openmpi@4.0.1+pmi fabrics=libfabric schedulers=slurm %intel@19.0.3'
  - 'mpich+hydra+romio+slurm netmod=ofi %gcc@8.3.0'
  - 'mpich+hydra+romio+slurm netmod=ofi %intel@19.0.3'
  # - 'mvapich2@2.3.1 fabrics=nemesisofi file_systems=lustre process_managers=slurm %gcc@8.3.0'
  # - 'mvapich2@2.3.1 fabrics=nemesisofi file_systems=lustre process_managers=slurm %intel@19.0.3'
  - 'openfoam@1812+metis %gcc@8.3.0 ^openmpi@4.0.1+pmi fabrics=libfabric schedulers=slurm'
  - 'lammps@20180822+class2+colloid+compress+coreshell+dipole+granular+kspace+lib+manybody+mc+meam+misc+molecule+mpi+mpiio+peri+poems+python+qeq+reax+replica+rigid+shock+snap+srd+user-atc+user-h5md+user-lb+user-misc+user-netcdf+user-omp %gcc@8.3.0 ^openmpi@4.0.1+pmi fabrics=libfabric schedulers=slurm ^openblas+avx2+avx512 threads=openmp ^libfabric@1.6.2'
